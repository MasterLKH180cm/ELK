<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ELK Stack Test Interface</title>
  <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
  <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }
    .container {
      max-width: 900px;
      margin: 0 auto;
    }
    .card {
      background: white;
      border-radius: 12px;
      padding: 30px;
      margin-bottom: 20px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.1);
    }
    h1 {
      color: #333;
      margin-bottom: 10px;
      font-size: 28px;
    }
    .subtitle {
      color: #666;
      margin-bottom: 25px;
      font-size: 14px;
    }
    .form-group {
      margin-bottom: 20px;
    }
    label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: #333;
      font-size: 14px;
    }
    input, select, textarea {
      width: 100%;
      padding: 12px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      font-size: 14px;
      transition: border-color 0.3s;
    }
    input:focus, select:focus, textarea:focus {
      outline: none;
      border-color: #667eea;
    }
    textarea {
      resize: vertical;
      min-height: 80px;
      font-family: monospace;
    }
    .btn {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      padding: 14px 28px;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
      width: 100%;
    }
    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
    }
    .btn:active {
      transform: translateY(0);
    }
    .btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }
    .status {
      padding: 12px;
      border-radius: 8px;
      margin-top: 20px;
      font-size: 14px;
    }
    .status.success {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }
    .status.error {
      background: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }
    .status.loading {
      background: #d1ecf1;
      color: #0c5460;
      border: 1px solid #bee5eb;
    }
    .log-preview {
      background: #f8f9fa;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      padding: 15px;
      margin-top: 15px;
      font-family: monospace;
      font-size: 13px;
      white-space: pre-wrap;
      word-break: break-all;
      max-height: 300px;
      overflow-y: auto;
    }
    .config-section {
      background: #f8f9fa;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 20px;
    }
    .config-section h3 {
      font-size: 16px;
      margin-bottom: 10px;
      color: #333;
    }
    .quick-actions {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 10px;
      margin-bottom: 20px;
    }
    .quick-btn {
      padding: 10px;
      background: #f8f9fa;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s;
      font-size: 13px;
      font-weight: 500;
    }
    .quick-btn:hover {
      border-color: #667eea;
      background: #fff;
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState } = React;

    function App() {
      const [logstashHost, setLogstashHost] = useState('localhost');
      const [logstashPort, setLogstashPort] = useState('8081');
      const [level, setLevel] = useState('info');
      const [message, setMessage] = useState('');
      const [customData, setCustomData] = useState('');
      const [status, setStatus] = useState(null);
      const [lastResponse, setLastResponse] = useState(null);

      const sendLog = async () => {
        setStatus({ type: 'loading', message: 'Sending log to Logstash...' });
        
        const logData = {
          timestamp: new Date().toISOString(),
          level: level,
          message: message || 'Test log message',
          test_id: `test_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,
          source: 'elk-test-frontend',
          environment: 'test'
        };

        if (customData.trim()) {
          try {
            const parsed = JSON.parse(customData);
            Object.assign(logData, parsed);
          } catch (e) {
            setStatus({ type: 'error', message: `Invalid JSON in custom data: ${e.message}` });
            return;
          }
        }

        try {
          const response = await fetch(`http://${logstashHost}:${logstashPort}`, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify(logData)
          });

          if (response.ok) {
            setStatus({ 
              type: 'success', 
              message: `‚úì Log sent successfully! Test ID: ${logData.test_id}`
            });
            setLastResponse(JSON.stringify(logData, null, 2));
          } else {
            setStatus({ 
              type: 'error', 
              message: `‚úó Failed to send log. Status: ${response.status}`
            });
          }
        } catch (error) {
          setStatus({ 
            type: 'error', 
            message: `‚úó Connection error: ${error.message}. Make sure Logstash is running and CORS is enabled.`
          });
        }
      };

      const quickFill = (preset) => {
        const presets = {
          error: { level: 'error', message: 'Database connection failed', customData: '{"error_code": "DB_CONN_FAIL", "retry_count": 3}' },
          warning: { level: 'warning', message: 'High memory usage detected', customData: '{"memory_usage": "85%", "threshold": "80%"}' },
          info: { level: 'info', message: 'User login successful', customData: '{"user_id": "12345", "ip_address": "192.168.1.100"}' },
          debug: { level: 'debug', message: 'API response received', customData: '{"endpoint": "/api/users", "response_time_ms": 243}' }
        };
        
        if (presets[preset]) {
          setLevel(presets[preset].level);
          setMessage(presets[preset].message);
          setCustomData(presets[preset].customData);
        }
      };

      return (
        <div className="container">
          <div className="card">
            <h1>üîç ELK Stack Test Interface</h1>
            <p className="subtitle">Send test logs to your Logstash HTTP input</p>

            <div className="config-section">
              <h3>Configuration</h3>
              <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '15px' }}>
                <div className="form-group">
                  <label>Logstash Host</label>
                  <input 
                    type="text" 
                    value={logstashHost}
                    onChange={(e) => setLogstashHost(e.target.value)}
                    placeholder="localhost"
                  />
                </div>
                <div className="form-group">
                  <label>Logstash Port</label>
                  <input 
                    type="text" 
                    value={logstashPort}
                    onChange={(e) => setLogstashPort(e.target.value)}
                    placeholder="8081"
                  />
                </div>
              </div>
            </div>

            <div className="quick-actions">
              <button className="quick-btn" onClick={() => quickFill('error')}>üí• Error Log</button>
              <button className="quick-btn" onClick={() => quickFill('warning')}>‚ö†Ô∏è Warning Log</button>
              <button className="quick-btn" onClick={() => quickFill('info')}>‚ÑπÔ∏è Info Log</button>
              <button className="quick-btn" onClick={() => quickFill('debug')}>üêõ Debug Log</button>
            </div>

            <div className="form-group">
              <label>Log Level</label>
              <select value={level} onChange={(e) => setLevel(e.target.value)}>
                <option value="debug">DEBUG</option>
                <option value="info">INFO</option>
                <option value="warning">WARNING</option>
                <option value="error">ERROR</option>
                <option value="critical">CRITICAL</option>
              </select>
            </div>

            <div className="form-group">
              <label>Message</label>
              <input 
                type="text" 
                value={message}
                onChange={(e) => setMessage(e.target.value)}
                placeholder="Enter your log message..."
              />
            </div>

            <div className="form-group">
              <label>Custom Data (JSON)</label>
              <textarea 
                value={customData}
                onChange={(e) => setCustomData(e.target.value)}
                placeholder='{"user_id": "123", "action": "login"}'
              />
            </div>

            <button className="btn" onClick={sendLog}>
              Send Log to Logstash
            </button>

            {status && (
              <div className={`status ${status.type}`}>
                {status.message}
              </div>
            )}

            {lastResponse && (
              <div>
                <h3 style={{ marginTop: '20px', marginBottom: '10px', color: '#333' }}>Last Sent Log:</h3>
                <div className="log-preview">{lastResponse}</div>
              </div>
            )}
          </div>

          <div className="card">
            <h3 style={{ marginBottom: '15px', color: '#333' }}>üìù Instructions</h3>
            <ol style={{ paddingLeft: '20px', lineHeight: '1.8', color: '#555' }}>
              <li>Make sure your ELK stack is running (<code>docker-compose up -d</code>)</li>
              <li>Verify Logstash HTTP input is accessible on port 8081</li>
              <li>Fill in the log details or use quick action buttons</li>
              <li>Click "Send Log to Logstash" to send a test log</li>
              <li>Check Kibana at <a href="http://localhost:5601" target="_blank">http://localhost:5601</a> to view the indexed logs</li>
            </ol>
            
            <h3 style={{ marginTop: '20px', marginBottom: '15px', color: '#333' }}>üîß CORS Error? Try This:</h3>
            <div style={{ background: '#f8f9fa', padding: '15px', borderRadius: '8px', fontSize: '13px' }}>
              <p style={{ marginBottom: '10px', color: '#555' }}><strong>Add CORS to Logstash config:</strong></p>
              <pre style={{ background: '#fff', padding: '10px', borderRadius: '4px', overflow: 'auto' }}>{`input {
  http {
    port => 8081
    codec => json
    response_headers => {
      "Access-Control-Allow-Origin" => "*"
      "Access-Control-Allow-Headers" => "Content-Type"
      "Access-Control-Allow-Methods" => "POST, OPTIONS"
    }
  }
}`}</pre>
              <p style={{ marginTop: '10px', color: '#555' }}>Then run: <code>docker-compose restart logstash</code></p>
            </div>
          </div>
        </div>
      );
    }

    ReactDOM.render(<App />, document.getElementById('root'));
  </script>
</body>
</html>